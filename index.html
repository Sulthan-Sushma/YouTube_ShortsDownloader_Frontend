<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>YouTube Video Downloader</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>YouTube Video Downloader</h1>
    <input type="text" id="videoLink" placeholder="Enter YouTube Video URL">
    <button onclick="downloadVideo()">Download</button>
    <div id="response"></div>

    <script>
    async function downloadVideo() {
        const link = document.getElementById('videoLink').value;
        const responseDiv = document.getElementById('response');

        if (!link) {
            responseDiv.textContent = "Please enter a YouTube URL";
            return;
        }

        responseDiv.textContent = "Downloading... Please wait...";

        try {
            const formData = new FormData();
            formData.append('link', link); // MUST match backend parameter name

            const response = await fetch(
                "https://youtubeshortsdownloaderbackend-production.up.railway.app/download",
                {
                    method: "POST",
                    body: formData
                }
            );

            // Convert response to blob for download
            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;

            // Use filename from response headers or fallback
            const contentDisposition = response.headers.get('Content-Disposition');
            let filename = "video.mp4";
            if (contentDisposition && contentDisposition.includes('filename=')) {
                filename = contentDisposition.split('filename=')[1].replace(/"/g, '');
            }

            a.download = filename;
            document.body.appendChild(a);
            a.click();
            a.remove();
            window.URL.revokeObjectURL(url);

            responseDiv.textContent = "Download completed!";

        } catch (error) {
            responseDiv.textContent = `Network Error: ${error.message}`;
            console.error('Detailed error:', error);
        }
    }
    </script>
</body>
</html>
